---
import { getCollection, type CollectionEntry } from 'astro:content';

type CartaEntry = CollectionEntry<'cartas'>;

// Pequeña función de ayuda para obtener un slug estable
function getCartaSlug(entry: CartaEntry): string {
  const data: any = entry.data;

  if (data.slug) {
    return String(data.slug);
  }

  if (data.clave) {
    return String(data.clave).replace(/_/g, '-');
  }

  const id = (entry as any).id ?? '';
  return id.replace(/\.md$/, '').split('/').pop() ?? id;
}

// Cargamos todas las cartas activas
const cartas = await getCollection('cartas', (entry) => entry.data.activo !== false);
---

<section class="cr-container" id="guias">
  <div class="cr-guides__intro">
  <h2>Guías y plantillas paso a paso</h2>
  <p>
    Elige el modelo que encaja con tu caso y revisa la descripción para saber cuándo utilizarla.
      </p>
  </div>

  <div class="cr-guides__grid">
    {cartas.map((entry: CartaEntry) => {
      const slug = getCartaSlug(entry);

      return (
        <a
          href={`/cartas/${slug}`}
        class="cr-guide-card"
        >
        <h3 class="cr-guide-card__title">{entry.data.titulo}</h3>
        <p class="cr-guide-card__description">{entry.data.descripcion}</p>
        </a>
      );
    })}
    </div>
</section>
